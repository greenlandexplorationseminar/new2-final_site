<!DOCTYPE HTML>
<html>
	<head>
		<title>Landslide Research Hub</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		
		<!-- Leaflet CSS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
		
		<style>
			#map-container {
				width: 100%;
				height: 600px;
				margin: 2em 0;
				position: relative;
				background: #1a1a1a;
			}
			#map {
				width: 100%;
				height: 100%;
			}
			.layer-control {
				position: absolute;
				top: 10px;
				right: 10px;
				z-index: 1000;
				background: white;
				padding: 10px;
				border-radius: 4px;
				box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			}
			.layer-control button {
				display: block;
				width: 100%;
				padding: 8px 12px;
				margin: 4px 0;
				border: none;
				background: #f4f4f4;
				cursor: pointer;
				border-radius: 3px;
				font-size: 14px;
			}
			.layer-control button:hover {
				background: #e0e0e0;
			}
			.layer-control button.active {
				background: #4a90e2;
				color: white;
			}
			/* Custom popup styling */
			.custom-popup .leaflet-popup-content-wrapper {
				background: white;
				border-radius: 8px;
				box-shadow: 0 3px 14px rgba(0,0,0,0.4);
			}
			.custom-popup .leaflet-popup-content {
				margin: 15px;
				font-family: inherit;
			}
			.custom-popup h3 {
				margin: 0 0 10px 0;
				font-size: 16px;
				font-weight: bold;
				color: #333;
			}
			.custom-popup .read-more-btn {
				display: inline-block;
				padding: 8px 16px;
				background: #e74c3c;
				color: white;
				text-decoration: none;
				border-radius: 4px;
				font-size: 14px;
				margin-top: 5px;
				transition: background 0.3s;
			}
			.custom-popup .read-more-btn:hover {
				background: #c0392b;
			}
			/* Cluster marker styling */
			.cluster-marker {
				background: #e74c3c;
				border: 3px solid white;
				border-radius: 50%;
				color: white;
				font-weight: bold;
				font-size: 16px;
				text-align: center;
				line-height: 40px;
				width: 40px;
				height: 40px;
				box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			}
			/* Custom red marker styling */
			.custom-red-marker {
				background: none;
				border: none;
			}
			/* Adjust footer split widths */
			#footer .split.contact {
				display: flex;
				flex-wrap: wrap;
			}
			#footer .split.contact > section:first-child {
				flex: 0 0 65%;
				max-width: 65%;
			}
			#footer .split.contact > section:nth-child(2),
			#footer .split.contact > section:nth-child(3) {
				flex: 0 0 17.5%;
				max-width: 17.5%;
			}
			@media screen and (max-width: 980px) {
				#footer .split.contact > section:first-child,
				#footer .split.contact > section:nth-child(2),
				#footer .split.contact > section:nth-child(3) {
					flex: 0 0 100%;
					max-width: 100%;
				}
			}
		</style>
	</head>
	<body class="is-preload">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Intro -->
					<div id="intro">
						<h1>Landslide Research<br />
						Hub</h1>
						<p>Advancing understanding and monitoring of landslide phenomena through cutting-edge research and technology.</p>
						<ul class="actions">
							<li><a href="#header" class="button icon solid solo fa-arrow-down scrolly">Continue</a></li>
						</ul>
					</div>

				<!-- Header -->
					<header id="header">
						<a href="index.html" class="logo">Landslide Research</a>
					</header>

				<!-- Nav -->
					<nav id="nav">
						<ul class="links">
							<li class="active"><a href="index.html">Home</a></li>
							<li><a href="case-studies.html">Case Studies</a></li>
							<li><a href="landslide-science.html">Landslide Science</a></li>
							<li><a href="monitoring-systems.html">Monitoring/Alarm Systems</a></li>
							<li><a href="ongoing-efforts.html">Ongoing Efforts</a></li>
						</ul>
						<ul class="icons">
							<li><a href="https://github.com/greenlandexplorationseminar/new2-final_site" target="_blank" class="icon brands fa-github"><span class="label">GitHub</span></a></li>
						</ul>
					</nav>

				<!-- Main -->
					<div id="main">

						<!-- Interactive Map Section -->
						<section id="map-section">
							<header class="major" style="text-align: center;">
								<h2>Greenland Landslides Explorer</h2>
								<p>Interactive map of historic landslides, impacts, and ongoing monitoring across Greenland</p>
							</header>
							<div id="map-container">
								<div class="layer-control">
									<button id="street-view" class="active">Regular View</button>
									<button id="satellite-view">Satellite View</button>
								</div>
								<div id="map"></div>
							</div>
						</section>

						<!-- Featured Post -->
							<article class="post featured">
								<header class="major">
									<h2 style="font-size: 2em;">Landslides in Greenland</h2>
									<p>The Greenland Ice Sheet is the second largest body of ice in the world, and is one of the largest contributors to sea level rise. As a result of climate change, air and water temperatures have increased over the past few decades, which has led to a net loss of ice mass in Greenland. This loss has been particularly significant in fjords, due to glacial ice coming in contact with warm ocean water. Melting of permafrost and degradation of glaciers weakens terrain and deforms slopes, which can result in loose mud and debris suddenly and rapidly sliding into the ocean, often causing tsunami sized waves to occur and potentially devastate communities. Since the mid-20th century, landslides of increasing magnitude have been documented, particularly in the Vaigat Strait/Nuussuaq/Disko Island region on the west coast of Greenland. This region is highly inhabited, and these natural disasters have been found to cause major damage to infrastructure and way of life for communities in this area.</p>
								</header>
							</article>

						<!-- Posts -->
							<section class="posts">
								<article>
									<header>
										<h2><a href="case-studies.html">Case Studies</a></h2>
									</header>
									<a href="case-studies.html" class="image fit"><img src="images/paatuut.jpg" alt="" /></a>
									<p>Some background on several significant landslide events from around Greenland</p>
									<ul class="actions special">
										<li><a href="case-studies.html" class="button">Read More</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a href="landslide-science.html">Landslide Science</a></h2>
									</header>
									<a href="landslide-science.html" class="image fit"><img src="images/molards.jpg" alt="" /></a>
									<p>Understanding the geological processes and mechanisms behind landslide phenomena</p>
									<ul class="actions special">
										<li><a href="landslide-science.html" class="button">Read More</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a href="monitoring-systems.html">Monitoring Systems</a></h2>
									</header>
									<a href="monitoring-systems.html" class="image fit"><img src="images/alarms_1.jpg" alt="" /></a>
									<p>Background about technology used for landslide susceptibility detection and warning</p>
									<ul class="actions special">
										<li><a href="monitoring-systems.html" class="button">Read More</a></li>
									</ul>
								</article>
								<article>
									<header>
										<h2><a href="ongoing-efforts.html">Ongoing Efforts</a></h2>
									</header>
									<a href="ongoing-efforts.html" class="image fit"><img src="images/ongoing_3.jpg" alt="" /></a>
									<p>Current research projects and collaborative initiatives advancing the understanding of landslide risks in Greenland</p>
									<ul class="actions special">
										<li><a href="ongoing-efforts.html" class="button">Read More</a></li>
									</ul>
								</article>
							</section>

					</div>

				<!-- Footer -->
					<footer id="footer">
						<section>
							<form method="post" action="https://formspree.io/f/greenlandexplorationseminar@gmail.com">
								<div class="fields">
									<div class="field">
										<label for="name">Name</label>
										<input type="text" name="name" id="name" />
									</div>
									<div class="field">
										<label for="email">Email</label>
										<input type="email" name="email" id="email" />
									</div>
									<div class="field">
										<label for="message">Message</label>
										<textarea name="message" id="message" rows="3"></textarea>
									</div>
								</div>
								<ul class="actions">
									<li><input type="submit" value="Send Message" /></li>
								</ul>
							</form>
						</section>
						<section class="split contact">
							<section>
								<h3>Email</h3>
								<p><a href="mailto:greenlandexplorationseminar@gmail.com">greenlandexplorationseminar@gmail.com</a></p>
							</section>
							<section>
								<h3>Open-Source Website Code</h3>
								<ul class="icons alt">
									<li><a href="https://github.com/greenlandexplorationseminar/new2-final_site" target="_blank" class="icon brands alt fa-github"><span class="label">GitHub</span></a></li>
								</ul>
							</section>
						</section>
					</footer>

				<!-- Copyright -->
					<div id="copyright">
						<ul><li>Landslide Group - Greenland Exploration Seminar - University of Washington</li><li>Design: <a href="https://html5up.net">HTML5 UP</a></li></ul>
					</div>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

			<!-- Leaflet JS -->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
			
			<script>
				// Initialize map centered on Greenland with EPSG:3857 (Web Mercator)
				var map = L.map('map', {
					center: [76, -42],
					zoom: 3,
					minZoom: 2,
					maxZoom: 18,
					zoomControl: true
				});

				// Base layers
				var streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					attribution: '© OpenStreetMap contributors',
					maxZoom: 19
				});

				var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
					attribution: 'Tiles © Esri',
					maxZoom: 19
				});

				// Add default layer
				streetLayer.addTo(map);

				// Wait for map to be ready
				map.whenReady(function() {
					console.log('Map is ready, zoom level:', map.getZoom());
				});

				// Layer switching
				var currentLayer = 'street';
				
				document.getElementById('street-view').addEventListener('click', function() {
					if (currentLayer !== 'street') {
						map.removeLayer(satelliteLayer);
						map.addLayer(streetLayer);
						currentLayer = 'street';
						this.classList.add('active');
						document.getElementById('satellite-view').classList.remove('active');
					}
				});

				document.getElementById('satellite-view').addEventListener('click', function() {
					if (currentLayer !== 'satellite') {
						map.removeLayer(streetLayer);
						map.addLayer(satelliteLayer);
						currentLayer = 'satellite';
						this.classList.add('active');
						document.getElementById('street-view').classList.remove('active');
					}
				});

				// Custom red pin icon using SVG - matching cluster color exactly
				var redIcon = L.divIcon({
					className: 'custom-red-marker',
					html: '<svg width="25" height="41" viewBox="0 0 25 41" xmlns="http://www.w3.org/2000/svg"><path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 8.4 12.5 28.5 12.5 28.5S25 20.9 25 12.5C25 5.6 19.4 0 12.5 0z" fill="#e74c3c" stroke="none"/><circle cx="12.5" cy="12.5" r="5" fill="white"/></svg>',
					iconSize: [25, 41],
					iconAnchor: [12, 41],
					popupAnchor: [1, -34]
				});

				// Define landslide locations
				var landslides = [
					{
						name: "Karrat Fjord (2017)",
						lat: 71.6426,
						lng: -52.2661,
						caseStudyId: "karrat-2017",
						clustered: false
					},
					{
						name: "Niiortuut (1952)",
						lat: 70.3490,
						lng: -53.1780,
						caseStudyId: "niiortuut-1952",
						clustered: true
					},
					{
						name: "Paatuut (1996, 2000)",
						lat: 70.2667,
						lng: -52.7500,
						caseStudyId: "paatuut-1996-2000",
						clustered: true
					},
					{
						name: "Assapaat (2021)",
						lat: 70.3191,
						lng: -52.9967,
						caseStudyId: "assapaat-2021",
						clustered: true
					},
					{
						name: "Dickson Fjord (2023)",
						lat: 72.8108,
						lng: -26.9681,
						caseStudyId: "dickson-2023",
						clustered: false
					}
				];

				// Custom red icon
				var redIcon = L.icon({
					iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
					shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
					iconSize: [25, 41],
					iconAnchor: [12, 41],
					popupAnchor: [1, -34],
					shadowSize: [41, 41]
				});

				// Clustered sites (west coast group)
				var westCoastSites = ["Niiortuut (1952)", "Paatuut (1996, 2000)", "Assapaat (2021)"];
				var westCoastCenter = [70.31, -52.97];

				var currentLockedMarker = null;  // Track which marker is currently locked
				var individualMarkers = [];  // Store individual markers
				var clusterMarker = null;  // Store cluster marker

				// Create cluster marker icon
				var clusterIcon = L.divIcon({
					className: 'cluster-marker',
					html: '3',
					iconSize: [40, 40],
					iconAnchor: [20, 20],
					popupAnchor: [0, -20]
				});

				// Create cluster marker for zoomed out view
				clusterMarker = L.marker(westCoastCenter, {icon: clusterIcon});
				
				var clusterPopupContent = '<div class="custom-popup"><h3>3 Landslide Sites</h3></div>';
				
				clusterMarker.bindPopup(clusterPopupContent, {
					className: 'custom-popup',
					autoClose: false,
					closeOnClick: false
				});

				clusterMarker.isLocked = false;

				clusterMarker.on('mouseover', function() {
					if (!this.isLocked) {
						this.openPopup();
					}
				});

				clusterMarker.on('mouseout', function() {
					if (!this.isLocked) {
						this.closePopup();
					}
				});

				clusterMarker.on('click', function(e) {
					// Zoom in to show individual markers
					map.setView(westCoastCenter, 10, {animate: true});
					L.DomEvent.stopPropagation(e);
				});

				// Add markers to map
				landslides.forEach(function(site) {
					var marker = L.marker([site.lat, site.lng], {icon: redIcon});
					
					var popupContent = '<div class="custom-popup"><h3>' + site.name + '</h3>' +
						'<a href="case-studies.html#' + site.caseStudyId + '" class="read-more-btn">Read More</a></div>';
					
					marker.bindPopup(popupContent, {
						className: 'custom-popup',
						autoClose: false,
						closeOnClick: false
					});
					
					marker.isLocked = false;
					marker.siteName = site.name;
					
					marker.on('mouseover', function() {
						if (!this.isLocked) {
							this.openPopup();
						}
					});
					
					marker.on('mouseout', function(e) {
						if (!this.isLocked) {
							this.closePopup();
						}
					});

					marker.on('click', function(e) {
						if (currentLockedMarker && currentLockedMarker !== this) {
							currentLockedMarker.isLocked = false;
							currentLockedMarker.closePopup();
						}
						
						this.isLocked = true;
						currentLockedMarker = this;
						this.openPopup();
						
						L.DomEvent.stopPropagation(e);
					});

					// Store markers for show/hide based on zoom
					if (site.clustered) {
						individualMarkers.push(marker);
					} else {
						marker.addTo(map);  // Always show non-clustered markers
					}
				});

				// Function to update marker visibility based on zoom
				function updateMarkerVisibility() {
					var currentZoom = map.getZoom();
					console.log('Zoom level:', currentZoom);
					
					if (currentZoom < 9) {
						// Zoomed out - show cluster, hide individuals
						if (!map.hasLayer(clusterMarker)) {
							clusterMarker.addTo(map);
							console.log('Added cluster marker');
						}
						individualMarkers.forEach(function(m) {
							if (map.hasLayer(m)) {
								map.removeLayer(m);
								console.log('Removed individual marker');
							}
						});
					} else {
						// Zoomed in - hide cluster, show individuals
						if (map.hasLayer(clusterMarker)) {
							map.removeLayer(clusterMarker);
							console.log('Removed cluster marker');
						}
						individualMarkers.forEach(function(m) {
							if (!map.hasLayer(m)) {
								m.addTo(map);
								console.log('Added individual marker');
							}
						});
					}
				}

				// Initial setup - call after a short delay to ensure map is ready
				setTimeout(function() {
					updateMarkerVisibility();
				}, 100);

				// Update on zoom
				map.on('zoomend', updateMarkerVisibility);

				// Click anywhere on map to unlock all popups
				map.on('click', function() {
					if (currentLockedMarker) {
						currentLockedMarker.isLocked = false;
						currentLockedMarker.closePopup();
						currentLockedMarker = null;
					}
					if (clusterMarker.isLocked) {
						clusterMarker.isLocked = false;
						clusterMarker.closePopup();
					}
				});
			</script>

	</body>
</html>
